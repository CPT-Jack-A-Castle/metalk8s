node:
  # 1. Everything fine
  - packages_ret: True
    services_ret: True
    result: True

  # 2. Error with packages
  - packages_ret: "Package abcd got an error because of banana"
    services_ret: True
    expect_raise: True
    result: "Node my_node_1: Package abcd got an error because of banana"
  # 2. bis (no raises)
  - packages_ret: "Package toto got an error :)"
    services_ret: True
    raises: False
    result: "Node my_node_1: Package toto got an error :)"

  # 3. Error with services
  - packages_ret: True
    services_ret: "Service abcd got an error because of penguin"
    expect_raise: True
    result: "Node my_node_1: Service abcd got an error because of penguin"

  # 4. Error with services and packages
  - packages_ret: "Package abcd got an error because of banana"
    services_ret: "Service abcd got an error because of penguin"
    expect_raise: True
    result: |-
      Node my_node_1: Package abcd got an error because of banana
      Service abcd got an error because of penguin

packages:
  # 1. Success: No conflicting packages to check
  - conflicting_packages: {}
    result: True

  # 2. Success: Conflicting packages not installed
  - conflicting_packages:
      my-not-installed-package: null
      my-not-installed-package2: null
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    result: True
  # 2. bis
  - conflicting_packages: my-not-installed-package
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    result: True
  # 2. ter
  - conflicting_packages:
     - my-not-installed-package
     - my-not-installed-package2
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    result: True

  # 3. Success: Conflicting packages (from map) not installed
  - get_map_ret:
      conflicting_packages:
        my-not-installed-package: null
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    result: True

  # 4. Success: Conflicting packages in specific version not installed
  - conflicting_packages:
      my-installed-package:
        - 1.2.4
        - 1.2.5
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    result: True

  # 5. Error: Conflicting packages installed
  - conflicting_packages:
      my-installed-package: null
      my-not-installed-package: null
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    expect_raise: True
    result: |-
      Package my-installed-package-1.2.3 conflicts with MetalK8s installation, please remove it.
  # 5. bis
  - conflicting_packages: my-installed-package
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    expect_raise: True
    result: |-
      Package my-installed-package-1.2.3 conflicts with MetalK8s installation, please remove it.
  # 5. ter
  - conflicting_packages:
      - my-not-installed-package
      - my-installed-package
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    expect_raise: True
    result: |-
      Package my-installed-package-1.2.3 conflicts with MetalK8s installation, please remove it.

  # 6. Error: Conflicting packages in specific version installed
  - conflicting_packages:
      my-installed-package: 1.2.3
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    expect_raise: True
    result: |-
      Package my-installed-package-1.2.3 conflicts with MetalK8s installation, please remove it.
  # 6. bis
  - conflicting_packages:
      my-installed-package:
        - 0.1.3
        - 1.2.4
        - 1.2.3
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    expect_raise: True
    result: |-
      Package my-installed-package-1.2.3 conflicts with MetalK8s installation, please remove it.
  # 6. ter (no raise)
  - conflicting_packages:
      my-installed-package:
        - 0.1.3
        - 1.2.4
        - 1.2.3
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
    raises: False
    result: |-
      Package my-installed-package-1.2.3 conflicts with MetalK8s installation, please remove it.

  # 7. Error: Multiple conflicting package installed
  - conflicting_packages:
      my-installed-package1: null
      my-installed-package2:
        - 5.6.7
    list_pkgs_ret:
      my-installed-package1:
        - version: 1.2.3
      my-installed-package2:
        - version: 5.6.7
    expect_raise: True
    result: |-
      Package my-installed-package1-1.2.3 conflicts with MetalK8s installation, please remove it.
      Package my-installed-package2-5.6.7 conflicts with MetalK8s installation, please remove it.

  # 8. Error: Multiple package of same version installed
  - conflicting_packages:
      my-installed-package: null
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
        - version: 4.5.6
    expect_raise: True
    result: |-
      Package my-installed-package-1.2.3 conflicts with MetalK8s installation, please remove it.
      Package my-installed-package-4.5.6 conflicts with MetalK8s installation, please remove it.
  # 8. bis
  - conflicting_packages:
      my-installed-package: 4.5.6
    list_pkgs_ret:
      my-installed-package:
        - version: 1.2.3
        - version: 4.5.6
    expect_raise: True
    result: |-
      Package my-installed-package-4.5.6 conflicts with MetalK8s installation, please remove it.

services:
  # 1. Success: No conflicting services to check
  - conflicting_services: []
    result: True

  # 2. Success: Conflicting services not installed
  - conflicting_services:
      - my-not-started-service
      - my-not-started-service2
    service_status_ret:
      my-not-started-service: False
      my-not-started-service2: False
    service_disabled_ret:
      my-not-started-service: True
      my-not-started-service2: True
    result: True
  # 2. bis
  - conflicting_services: my-not-started-service
    service_status_ret:
      my-not-started-service: False
    service_disabled_ret:
      my-not-started-service: True
    result: True

  # 3. Success: Conflicting service (from map) not started
  - get_map_ret:
      conflicting_services:
        - my-not-started-service
    service_status_ret:
      my-not-started-service: False
    service_disabled_ret:
      my-not-started-service: True
    result: True

  # 4. Error: Conflicting service started
  - conflicting_services:
      - my-started-service
      - my-not-started-service
    service_status_ret:
      my-started-service: True
      my-not-started-service: False
    service_disabled_ret:
      my-started-service: False
      my-not-started-service: True
    expect_raise: True
    result: |-
      Service my-started-service conflicts with MetalK8s installation, please stop and disable it.
  # 4. bis
  - conflicting_services: my-started-service
    service_status_ret:
      my-started-service: True
    service_disabled_ret:
      my-started-service: True
    expect_raise: True
    result: |-
      Service my-started-service conflicts with MetalK8s installation, please stop and disable it.
  # 4. ter (no raise)
  - conflicting_services: my-started-service
    raises: False
    service_status_ret:
      my-started-service: True
    service_disabled_ret:
      my-started-service: True
    result: |-
      Service my-started-service conflicts with MetalK8s installation, please stop and disable it.

  # 5. Service stopped but still enabled
  - conflicting_services: my-enabled-service
    service_status_ret:
      my-enabled-service: False
    service_disabled_ret:
      my-enabled-service: False
    expect_raise: True
    result: |-
      Service my-enabled-service conflicts with MetalK8s installation, please stop and disable it.

sysctl:
  - params:
      net.ipv4.ip_forward: 1
    data:
      net.ipv4.ip_forward: '1'
    result: ''
  - params:
      net.ipv4.ip_forward: '1'
      kernel.sysrq: '1'
    data:
      net.ipv4.ip_forward: '1'
      kernel.sysrq: '1'
    result: ''
  - params:
      net.ipv4.ip_forward: 1
    data:
      net.ipv4.ip_forward: '0'
    result: 'Incorrect value for .*'
    raises: True
